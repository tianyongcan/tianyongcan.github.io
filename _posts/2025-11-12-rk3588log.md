---
title: rk3588开发日志
date: 2025-11-12 10:30:00 +0800
categories:
tags:
pin: false
layout: post
---
# 开发板连接

板端启动可通过串口连接进入命令行，通过命令行连接开发板实现wifi连接，rk3588自带板载wifi，连接后可启动ssh连接开发板终端，可不再使用串口进行连接。

在连接实验室网络时，IP地址固定

在PC端使用ssh连接开发板，注意电脑需要与开发板在同一网络下才可实现ssh连接，连接不通请互相ping地址，注意PC端防火墙，可关闭防火墙重试，如关闭防火墙可以ping通，可以设置防火墙规则开放ssh 22号端口

ssh连接可能会有网络波动导致连接不稳定，使用串口实现板端连接是最稳定的办法

# adb传输
adb传输需要更换连接端口。
目前采用的开发方式是在服务器上进行编译，传回PC端之后与板端进行adb连接推送
模型用adb传输后需要给执行文件执行权限

```
chmod +x rknn_yolov5_cam
```

# SDK编译
SDK编译要求在ubuntu20.04环境中进行编译，由于服务器环境为22.04，导致编译过程中出现linux环境问题较多，转而使用docker创建环境

# docker使用
构建docker流程如下：
创建一个新的文件夹来存放我们的 Dockerfile
```
mkdir -p ~/rk3588_build_env cd ~/rk3588_build_env
```
**创建 Dockerfile 文件**
```
vim Dockerfile
```

```
# 使用官方的 Ubuntu 20.04 作为基础
FROM ubuntu:20.04

# 设置环境变量，避免安装时出现交互式提示
ENV DEBIAN_FRONTEND=noninteractive

# 更新apt源并安装所有手册要求的依赖
# 注意：我们在这里先不安装bison，留到后面手动安装指定版本
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    git ssh make gcc libssl-dev liblz4-tool expect expect-dev g++ patchelf \
    chrpath gawk texinfo diffstat binfmt-support qemu-user-static live-build \
    flex fakeroot cmake gcc-multilib g++-multilib unzip device-tree-compiler \
    ncurses-dev bzip2 expat gpgv2 cpp-aarch64-linux-gnu libgmp-dev libmpc-dev \
    bc python-is-python3 python2 wget \
    && rm -rf /var/lib/apt/lists/*

# 手动下载并安装一个已知可以工作的旧版本 bison (3.5.1)
RUN apt-get update && \
    apt-get install -y wget && \
    wget http://archive.ubuntu.com/ubuntu/pool/main/b/bison/bison_3.5.1+dfsg-1_amd64.deb && \
    dpkg -i bison_3.5.1+dfsg-1_amd64.deb && \
    rm bison_3.5.1+dfsg-1_amd64.deb && \
    apt-mark hold bison && \
    rm -rf /var/lib/apt/lists/*

# 创建一个非root工作用户，这更安全，也更符合SDK脚本的预期
# 同时将用户加入sudo组，方便在容器内临时提权
RUN useradd -ms /bin/bash user && \
    adduser user sudo && \
    echo "user ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# 切换到这个新用户
USER user
WORKDIR /home/user

# 设置默认命令，当容器启动时，给我们一个bash终端
CMD ["/bin/bash"]
```

构建docker镜像,需要修改docker下载镜像源，参考b站
```
docker build -t rk3588-build-env .
```
创建容器
```
docker run -it --name rk3588-compiler \ -v /data/user/rk3D/rk3588_linux_sdk:/home/user/rk3588_linux_sdk \ rk3588-build-env
```

| 命令            | 功能          | 示例                            |
| ------------- | ----------- | ----------------------------- |
| docker ps     | 列出当前正在运行的容器 |                               |
| docker start  | 启动已经存在的容器   | docker start rk3588-compiler  |
| docker attach | 进入容器终端      | docker attach rk3588-compiler |
| exit          | 停止容器        |                               |
# 保存docker镜像
## 方法一： Dockerfile
```
# 使用官方的 Ubuntu 20.04 作为基础
FROM ubuntu:20.04

# 设置环境变量，避免安装时出现交互式提示
ENV DEBIAN_FRONTEND=noninteractive

# 更新apt源并一次性安装所有已知依赖
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    git ssh make gcc libssl-dev liblz4-tool expect expect-dev g++ patchelf \
    chrpath gawk texinfo diffstat binfmt-support qemu-user-static live-build \
    flex fakeroot cmake gcc-multilib g++-multilib unzip device-tree-compiler \
    ncurses-dev bzip2 expat gpgv2 cpp-aarch64-linux-gnu libgmp-dev libmpc-dev \
    bc python-is-python3 python2 wget sudo \
    time file rsync patch vim-common ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# 手动下载并安装一个已知可以工作的旧版本 bison (3.5.1)
RUN apt-get update && \
    apt-get install -y wget && \
    wget http://archive.ubuntu.com/ubuntu/pool/main/b/bison/bison_3.5.1+dfsg-1_amd64.deb && \
    dpkg -i bison_3.5.1+dfsg-1_amd64.deb && \
    rm bison_3.5.1+dfsg-1_amd64.deb && \
    apt-mark hold bison && \
    rm -rf /var/lib/apt/lists/*

# 创建一个非root工作用户，并赋予sudo免密权限
RUN useradd -ms /bin/bash user && \
    adduser user sudo && \
    echo "user ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# 切换到这个新用户
USER user
WORKDIR /home/user

# 设置默认命令
CMD ["/bin/bash"]
```
可以用上面的文件来创造镜像
## 方法二：快照

```
docker commit rk3588-compiler rk3588-build-env:snapshot
```





# build.sh bug解决
编译打包脚本有问题，编译成功后会在对应文件夹生成软链接，实际文件在软连接对应位置存放
为了方便进行烧录，写了个脚本将对应文件汇总到output的img文件夹下
在sdk目录下运行以下命令即可
```
./collect_images.sh
```
